{% load static %}
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Efficient Study</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="{% static '/css/register.css' %}">
    <script type="text/javascript" src="{% static '/js/register.js' %}"></script>
</head>

<body>

    <div class="container">
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-primary alert-dismissible fade show" role="alert">
            <strong> {{ message }} </strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}

        <div class="alert alert-success" id="infoAlert" role="alert" style="display: none;">

            <h4 class="alert-heading">Information</h4>
            <p>The verification code that should be typed in the "Verification code" input field is sent via email by
                pressing the envelope icon. The fields that are required to be completed for sending the verification
                code are the
                "User Name" and "Email Address" input fields.
            </p>
            <hr>
            <button type="button" onclick="closeInfo()" style="border: none; background: none;">
                <span aria-hidden="true" style="font-size: 1.2rem;">&times;</span>
            </button>

        </div>

        <div class="p-2 d-flex justify-content-between align-items-center">
            <a href="{% url 'home' %}"> <svg xmlns=" http://www.w3.org/2000/svg" width="24" height="24"
                    fill="currentColor" class="bi bi-arrow-left-square" viewBox="0 0 16 16"
                    style="color: #e4e0f3; cursor: pointer;">
                    <path fill-rule="evenodd"
                        d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z" />
                </svg>
                </svg>
            </a>
            <button type="button" onclick="showInfo()" style="background: none; border: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                    class="bi bi-info-square" viewBox="0 0 16 16" style="color: #e4e0f3; cursor: pointer;">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                    <path
                        d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0" />
                </svg>
            </button>
        </div>

        <div class="mx-auto d-flex flex-column align-items-center justify-content-center minimal-form"
            style="min-height: 90vh;">
            <div class="col-md-6">
                <h1>Create an account</h1>
                <br />

                <form method="POST" action="">
                    {% csrf_token %}
                    {% if form.errors %}
                    <div class="alert alert-primary alert-dismissible fade show" role="alert">
                        Your Form Has errors
                        {% for field in form %}
                        {% if field.errors %}
                        {{ field.errors }}
                        {% endif %}
                        {% endfor %}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">

                        </button>
                    </div>
                    {% endif %}

                    <p>
                        <!-- {{ form.as_p }} -->

                        <input type="text" name="username" id="username" maxlength="150" autofocus class="form-control"
                            placeholder="User Name" required aria-describedby="id_username_helptext" id="id_username">
                        <span class="helptext" id="id_username_helptext">
                            <span class="form-text text-muted">
                                <small>Required. 100 characteres or fewer letters, digits and @/./+/-/_ only.</small>
                            </span>
                        </span>
                    </p>

                    <p>
                        <input type="text" name="first_name" class="form-control" placeholder="First Name"
                            maxlength="100" required id="id_first_name">
                    </p>

                    <p>
                        <input type="text" name="last_name" class="form-control" placeholder="Last Name" maxlength="100"
                            required id="id_last_name">
                    </p>

                    <p>

                    <div class="input-group">
                        <input type="text" name="email" id="email" class="form-control" placeholder="Email Address"
                            maxlength="320" required id="id_email">

                        <div class="input-group-text border-1" style="background-color: #2a2633; border-color: #444; 
                                border-top-left-radius: 0px;
                                border-bottom-left-radius: 0px;
                                border-top-right-radius: 0px;
                                border-bottom-right-radius: 0px;
                                ">

                            <svg xmlns="http://www.w3.org/2000/svg" id="btnSendVerificationCode" width="30" height="43"
                                fill="currentColor" style="color: #e4e0f3; cursor: pointer;"
                                onclick="sendVerificationCode()" class="bi bi-eye" viewBox="0 0 16 16">
                                <path
                                    d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zm.192 8.159 6.57-4.027L8 9.586l1.239-.757.367.225A4.49 4.49 0 0 0 8 12.5c0 .526.09 1.03.256 1.5H2a2 2 0 0 1-1.808-1.144M16 4.697v4.974A4.5 4.5 0 0 0 12.5 8a4.5 4.5 0 0 0-1.965.45l-.338-.207z" />
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.354-5.354 1.25 1.25a.5.5 0 0 1-.708.708L13 12.207V14a.5.5 0 0 1-1 0v-1.717l-.28.305a.5.5 0 0 1-.737-.676l1.149-1.25a.5.5 0 0 1 .722-.016" />
                            </svg>

                        </div>

                        <input type="text" name="verification_code" class="form-control" placeholder="Verification Code"
                            maxlength="8" id="id_verification_code" required>
                    </div>

                    </p>

                    <p>

                    <div class="input-group">
                        <input type="password" name="password1" autocomplete="new-password" class="form-control"
                            placeholder="Password" required aria-describedby="id_password1_helptext" id="id_password1">
                        <div class="input-group-append">
                            <div class="input-group-text border-1" style="background-color: #2a2633; border-color: #444; 
                                border-top-left-radius: 0px;
                                border-bottom-left-radius: 0px;
                                border-top-right-radius: 5px;
                                border-bottom-right-radius: 5px;
                                ">
                                <svg xmlns="http://www.w3.org/2000/svg" id="btnEye1" width="30" height="43"
                                    fill="currentColor" style="color: #e4e0f3; cursor: pointer;"
                                    onclick="showPassword('id_password1', 'btnEye1')" class="bi bi-eye"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z" />
                                    <path
                                        d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829" />
                                    <path
                                        d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z" />
                                </svg>
                                <!-- open eye svg
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                                    <path
                                        d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z" />
                                    <path
                                        d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0" />
                                </svg>
                                -->
                            </div>
                        </div>
                    </div>

                    <span class="helptext" id="id_password1_helptext">
                        <ul class="form-text text-muted small">
                            <li>Your password can't be too similar to your other personal information.</li>
                            <li>Your password must contain at least 8 characters.</li>
                            <li>Your password can't be a commonly used password.</li>
                            <li>Your password can't be entirely numeric.</li>
                        </ul>
                    </span>
                    </p>

                    <p>

                    <div class="input-group mb-2">
                        <input type="password" name="password2" autocomplete="new-password" class="form-control"
                            placeholder="Confirm Password" required aria-describedby="id_password2_helptext"
                            id="id_password2">
                        <div class="input-group-append">
                            <div class="input-group-text border-1" style="background-color: #2a2633; border-color: #444; 
                                border-top-left-radius: 0px;
                                border-bottom-left-radius: 0px;
                                border-top-right-radius: 5px;
                                border-bottom-right-radius: 5px;
                                ">
                                <svg xmlns="http://www.w3.org/2000/svg" id="btnEye2" width="30" height="43"
                                    fill="currentColor" style="color: #e4e0f3; cursor: pointer;"
                                    onclick="showPassword('id_password2', 'btnEye2')" class="bi bi-eye"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z" />
                                    <path
                                        d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829" />
                                    <path
                                        d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z" />
                                </svg>
                                <!-- open eye svg
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                                    <path
                                        d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z" />
                                    <path
                                        d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0" />
                                </svg>
                                -->
                            </div>
                        </div>
                    </div>

                    <span class="helptext" id="id_password2_helptext">
                        <span class="form-text text-muted">
                            <small>Enter the same password as before, for verification.</small>
                        </span>
                    </span>
                    </p>

                    <button type="submit" class="btn-submit">
                        Register
                    </button>
                    <div class="text-center p-2">
                        <a href="{% url 'login' %}" class="text-decoration-none form-text">Do you have an account?</a>
                    </div>
                </form>

            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        function sendVerificationCode() {
            var username = document.getElementById("username").value;
            var email = document.getElementById("email").value;

            if (!username || !email) {
                Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Username or email is missing!",
                    color: '#e4e0f3',
                    background: '#110f16',
                    confirmButtonColor: '#5c5470'

                });
                return;
            }

            fetch("{% url 'send_verification_code' %}", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{csrf_token}}',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-Requested-For': 'Registration'
                },
                body: JSON.stringify({ username, email })
            })
                .then(response => response.json())
                .then(data =>
                    Swal.fire({
                        icon: "success",
                        title: "Verification code was sent successfully!",
                        showConfirmButton: false,
                        timer: 2200,
                        color: '#e4e0f3',
                        background: '#110f16'
                    })
                )
                .catch(err =>
                    Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: "There was an error sending the verification code!",
                        color: '#e4e0f3',
                        background: '#110f16',
                        showConfirmButton: false,
                        timer: 2500,
                    })
                )

        }
    </script>
</body>

</html>